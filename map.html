<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Station Maps</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .map-container {
      margin: 20px auto;
      max-width: 900px;
    }
    .map {
      height: 500px;
      margin-bottom: 40px;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    .circle-label {
      background: transparent;
      border: none;
      box-shadow: none;
      font-weight: bold;
      font-size: 14px;
      color: black;
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="map-container">
    <h2>All Stations Coverage</h2>
    <div id="all-stations-map" class="map"></div>
  </div>

  <div class="map-container">
    <h2>107.7 FM Coverage</h2>
    <div id="map-1077" class="map"></div>
  </div>

  <div class="map-container">
    <h2>92.1 FM Coverage</h2>
    <div id="map-921" class="map"></div>
  </div>

  <div class="map-container">
    <h2>95.7 HD2 Coverage</h2>
    <div id="map-957" class="map"></div>
  </div>

  <div class="map-container">
    <h2>WPEO 98.3 FM Coverage</h2>
    <div id="map-983" class="map"></div>
  </div>

  <script>
    // Map configs
    const mapConfigs = [
      {
        id: "map-1077",
        center: [40.4842, -88.9937],
        color: "#ff7f00",
        ranges: [
          { m: 40000, o: 0.35 },
          { m: 25000, o: 0.35 },
          { m: 10000, o: 0.35 }
        ],
        tooltip: "107.7 FM",
        url: "https://1077thebull.com"
      },
      {
        id: "map-921",
        center: [40.4842, -88.9937],
        color: "#377eb8",
        ranges: [
          { m: 40000, o: 0.35 },
          { m: 25000, o: 0.35 },
          { m: 10000, o: 0.35 }
        ],
        tooltip: "92.1 FM",
        url: "https://921thebull.com"
      },
      {
        id: "map-957",
        center: [40.4842, -88.9937],
        color: "#4daf4a",
        ranges: [
          { m: 40000, o: 0.35 },
          { m: 25000, o: 0.35 },
          { m: 10000, o: 0.35 }
        ],
        tooltip: "95.7 HD2",
        url: "https://957thebull.com"
      },
      {
        id: "map-983",
        center: [40.7042, -89.6037],
        color: "#984ea3",
        ranges: [
          { m: 40000, o: 0.35 },
          { m: 25000, o: 0.35 },
          { m: 10000, o: 0.35 }
        ],
        tooltip: "WPEO 98.3 FM",
        url: "https://wpeo.com"
      }
    ];

    // Create individual station maps (normal Leaflet circles)
    function createStationMap(cfg) {
      const map = L.map(cfg.id).setView(cfg.center, 9);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
      }).addTo(map);

      [...cfg.ranges]
        .sort((a, b) => b.m - a.m)
        .forEach((r) => {
          const circle = L.circle(cfg.center, {
            radius: r.m,
            fillColor: cfg.color,
            fillOpacity: r.o,
            stroke: false,
            interactive: true,
          }).addTo(map);

          const largestRadius = Math.max(...cfg.ranges.map(x => x.m));
          if (cfg.tooltip && cfg.url && r.m !== largestRadius) {
            circle.bindTooltip(cfg.tooltip, { permanent: true, direction: "center", className: "circle-label" });
            circle.on("click", () => window.open(cfg.url, "_blank"));
          }
        });
    }

    mapConfigs.forEach(cfg => createStationMap(cfg));

    // Create "All Stations" map with Turf.js subtraction for no blending
    function createAllStationsMap() {
      const allStationsMap = L.map("all-stations-map").setView([40.4842, -88.9937], 8);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
      }).addTo(allStationsMap);

      let drawn = [];

      // Sort so largest coverage draws first
      [...mapConfigs]
        .sort((a, b) => {
          const aMax = Math.max(...a.ranges.map(r => r.m));
          const bMax = Math.max(...b.ranges.map(r => r.m));
          return bMax - aMax;
        })
        .forEach(cfg => {
          let largestRange = Math.max(...cfg.ranges.map(r => r.m));

          // Turf circle uses kilometers, so convert meters -> km
          let circlePoly = turf.circle([cfg.center[1], cfg.center[0]], largestRange / 1000, {
            steps: 64,
            units: "kilometers"
          });

          // Subtract already drawn areas
          drawn.forEach(d => {
            const diff = turf.difference(circlePoly, d);
            if (diff) circlePoly = diff;
          });

          if (circlePoly) {
            L.geoJSON(circlePoly, {
              style: {
                fillColor: cfg.color,
                fillOpacity: 0.35,
                stroke: false
              }
            }).addTo(allStationsMap);

            drawn.push(circlePoly);
          }
        });
    }

    createAllStationsMap();
  </script>
</body>
</html>
