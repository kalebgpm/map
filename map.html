<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Station Coverage Maps</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    .tabs {
      display: flex;
      background: #333;
    }
    .tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      color: white;
      cursor: pointer;
    }
    .tab.active {
      background: #555;
      border-bottom: 2px solid yellow;
    }
    .map-container {
      display: none;
      width: 100%;
      height: 600px;
      position: relative;
    }
    .map-container.active {
      display: block;
    }
    .circle-label {
      font-weight: bold;
      background: transparent;
      border: none;
      box-shadow: none;
      color: black;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" data-target="map1">Station 1</div>
    <div class="tab" data-target="map2">Station 2</div>
    <div class="tab" data-target="map3">Station 3</div>
    <div class="tab" data-target="map4">All Stations</div>
  </div>

  <div id="map1" class="map-container active"></div>
  <div id="map2" class="map-container"></div>
  <div id="map3" class="map-container"></div>
  <div id="map4" class="map-container"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
  // example config
  const mapConfigs = [
    {
      id: "map1",
      center: [40.0, -89.0],
      zoom: 7,
      ranges: [{ m: 30000 }, { m: 60000 }],
      color: "red",
      label: "Station 1"
    },
    {
      id: "map2",
      center: [41.0, -90.0],
      zoom: 7,
      ranges: [{ m: 40000 }],
      color: "blue",
      label: "Station 2"
    },
    {
      id: "map3",
      center: [39.5, -88.5],
      zoom: 7,
      ranges: [{ m: 50000 }, { m: 80000 }],
      color: "green",
      label: "Station 3"
    }
  ];

  // --- add outlines ---
  function addStateOutlines(map) {
    fetch('https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json')
      .then(r => r.json())
      .then(data => {
        data.features.forEach(feat => {
          L.geoJSON(feat, {
            style: {
              color: 'black',
              weight: 1,
              opacity: 1,
              fillOpacity: 0
            }
          }).addTo(map);
        });
      });
  }

  // --- overlay helper ---
  function createOverlay(mapContainer) {
    const overlay = document.createElement("div");
    overlay.style.position = "absolute";
    overlay.style.top = 0;
    overlay.style.left = 0;
    overlay.style.width = "100%";
    overlay.style.height = "100%";
    overlay.style.background = "rgba(0,0,0,0.6)";
    overlay.style.color = "white";
    overlay.style.display = "flex";
    overlay.style.justifyContent = "center";
    overlay.style.alignItems = "center";
    overlay.style.fontSize = "18px";
    overlay.style.zIndex = 500;
    overlay.style.textAlign = "center";
    overlay.innerHTML = "Hold <b>Alt</b> and scroll to zoom the map.";
    overlay.style.display = "none";
    mapContainer.style.position = "relative";
    mapContainer.appendChild(overlay);
    return overlay;
  }

  // --- alt scroll logic ---
  function enableAltScroll(map) {
    const container = map.getContainer();
    const overlay = createOverlay(container);

    let altHeld = false;
    let hideTimeout = null;

    function handleAltDown(e) {
      if (e.key === 'Alt' && !altHeld) {
        altHeld = true;
        map.scrollWheelZoom.enable();
        overlay.style.display = "none";
      }
    }
    function handleAltUp(e) {
      if (e.key === 'Alt') {
        altHeld = false;
        map.scrollWheelZoom.disable();
      }
    }

    container.addEventListener('mouseenter', () => {
      window.addEventListener('keydown', handleAltDown);
      window.addEventListener('keyup', handleAltUp);
    });
    container.addEventListener('mouseleave', () => {
      window.removeEventListener('keydown', handleAltDown);
      window.removeEventListener('keyup', handleAltUp);
      map.scrollWheelZoom.disable();
      altHeld = false;
      overlay.style.display = "none";
    });

    container.addEventListener('wheel', e => {
      if (!altHeld) {
        e.preventDefault();
        overlay.style.display = "flex";

        if (hideTimeout) clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          overlay.style.display = "none";
        }, 2000);
      }
    }, { passive: false });
  }

  // --- station maps ---
  function createStationMap(id, cfg) {
    const map = L.map(id, { scrollWheelZoom: false }).setView(cfg.center, cfg.zoom || 7);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CartoDB'
    }).addTo(map);

    addStateOutlines(map);

    cfg.ranges.forEach(r => {
      L.circle(cfg.center, {
        radius: r.m,
        fillColor: cfg.color,
        fillOpacity: 0.35,
        stroke: false
      }).addTo(map);
    });

    L.tooltip({
      permanent: true,
      direction: 'center',
      className: 'circle-label'
    })
      .setLatLng(cfg.center)
      .setContent(cfg.label)
      .addTo(map);

    enableAltScroll(map);
    return map;
  }

  const maps = [];
  mapConfigs.forEach(cfg => {
    maps.push(createStationMap(cfg.id, cfg));
  });

  // --- All stations map ---
  function createAllStationsMap() {
    const allStationsMap = L.map('map4', { scrollWheelZoom: false }).setView([40.0, -89.0], 7);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CartoDB'
    }).addTo(allStationsMap);

    addStateOutlines(allStationsMap);

    mapConfigs.forEach(cfg => {
      const largestRange = Math.max(...cfg.ranges.map(r => r.m));
      L.circle(cfg.center, {
        radius: largestRange,
        fillColor: cfg.color,
        fillOpacity: 0.35,
        stroke: false
      }).addTo(allStationsMap);
    });

    L.tooltip({
      permanent: true,
      direction: 'center',
      className: 'circle-label'
    })
      .setLatLng([40.0, -89.0])
      .setContent("All Stations")
      .addTo(allStationsMap);

    enableAltScroll(allStationsMap);
    maps.push(allStationsMap);
  }
  createAllStationsMap();

  // --- tabs logic ---
  const tabs = document.querySelectorAll(".tab");
  const containers = document.querySelectorAll(".map-container");

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      containers.forEach(c => c.classList.remove("active"));

      tab.classList.add("active");
      const target = document.getElementById(tab.dataset.target);
      target.classList.add("active");

      maps.forEach(m => m.invalidateSize());
    });
  });
  </script>
</body>
</html>

